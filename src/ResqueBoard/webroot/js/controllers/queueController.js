angular.module("app").controller("queueController",["$scope","$http","$timeout","jobsProcessedCounter","workersStartListener","workersStopListener",function(a,b,c,d,e,f){"use strict";function g(){for(var b in a.queues)a.queues[b].stats.totaljobsperc=100*a.queues[b].stats.totaljobs/a.stats.totaljobs}a.stats={totaljobs:0},a.queues=[],a.predicate="stats.totaljobs",a.reverse=!0,a._init=0,a._errorCode=0;var h={};a.init=function(){a._init=0,b({method:"GET",url:"api/queues?fields=totaljobs,pendingjobs,workerscount"}).success(function(b){a.queues=b;for(var c in a.queues)a.stats.totaljobs+=a.queues[c].stats.totaljobs,h[a.queues[c].name]=parseInt(c,10);0===a.queues.length?a._init=2:a._init=1,g()}).error(function(b,c){a._errorCode=c,a._errorMessage=b.message,a._init=3})},a.init(),d.onmessage(function(b){var c=JSON.parse(b.data);a.queues[h[c.data.args.queue]].stats.totaljobs++,a.stats.totaljobs++}),e.onmessage(function(b){var c=JSON.parse(b.data),d=c.data.worker.split(":"),e=d[2].split(",");for(var f in e)h.hasOwnProperty(e[f])?a.queues[h[e[f]]].stats.workerscount++:(a.queues.push({name:e[f],stats:{totaljobs:0,pendingjobs:0,workerscount:1}}),h[e[f]]=a.queues.length-1);a._init=1});var i=["pendingjobs"];f.onmessage(function(a){JSON.parse(a.data);i.push("workerscount")});var j=5e3,k=function(){b({method:"GET",url:"api/queues?fields="+i.join(",")+"&queues="+Object.keys(h).join(",")}).success(function(b){for(var c in b)for(var d in i)a.queues.hasOwnProperty(h[b[c].name])&&(a.queues[h[b[c].name]].stats[i[d]]=parseInt(b[c].stats[i[d]],10));i=["pendingjobs"]}).error(function(){}),c(k,j)};c(k,j)}]);